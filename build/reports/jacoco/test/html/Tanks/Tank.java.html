<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Tank.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TanksGame2024</a> &gt; <a href="index.source.html" class="el_package">Tanks</a> &gt; <span class="el_source">Tank.java</span></div><h1>Tank.java</h1><pre class="source lang-java linenums">package Tanks;

import org.checkerframework.checker.units.qual.A;
import org.json.JSONTokener;
import processing.core.PApplet;
import processing.core.PImage;
import processing.core.PShape;
import processing.core.PVector;
import processing.data.JSONArray;
import processing.data.JSONObject;
import processing.event.KeyEvent;
import processing.event.MouseEvent;

import java.awt.*;
import java.awt.geom.AffineTransform;
import java.awt.image.BufferedImage;

import java.io.*;
import java.util.*;
import java.lang.Math;


public class Tank {
    private App app;
    private float xCoordinate;
    private float yCoordinate;
    private float turretXCoordinate;
    private float turretYCoordinate;
    private int[] colourScheme;
    private Level levelObj;
    private int tankWidth;
    private int tankHeight;
    private int turretWidth;
    private float[] movingAverages;
    private Player player;
    private PShape tank;
    private float angle;
    private int speed;
<span class="fc" id="L39">    private boolean rotateTurret=false;</span>
    private Projectile projectile;
    private float tankCentreX;
    private float tankCentreY;
<span class="fc" id="L43">    private int arrowCount = 0;</span>
<span class="fc" id="L44">    private boolean arrowOn = false;</span>
<span class="fc" id="L45">    private float explosionRadius = 0;</span>
<span class="fc" id="L46">    private boolean explosionOut = false;</span>
<span class="fc" id="L47">    private boolean insideExplosion = false;</span>

    /**
     * Constructor for Tank object.
     * 
     * @param xCoordinate is the x-coordinate of a tank, which updates when the LEFT and RIGHT keys are pressed.
     * @param yCoordinate is the y-coordinate of a tank, which is grounded to the terrain, unless the tank is falling after the terrain below it falls.
     * @param colourScheme is the colour scheme of the Player object which the Tank object belongs to.
     * @param app is the App object that we will pass through to allow for drawing + more implementations of the PApplet library.
     * @param levelObj is the Level object which the Tank object belongs to.
     * @param player is the Player object which the Tank object belongs to.
     */
<span class="fc" id="L59">    public Tank(float xCoordinate, float yCoordinate, int[] colourScheme, App app, Level levelObj, Player player) {</span>
<span class="fc" id="L60">        this.colourScheme = colourScheme;</span>
<span class="fc" id="L61">        this.xCoordinate = xCoordinate;</span>
<span class="fc" id="L62">        this.yCoordinate = yCoordinate;</span>
<span class="fc" id="L63">        this.app = app;</span>
<span class="fc" id="L64">        this.levelObj = levelObj;</span>
<span class="fc" id="L65">        this.tankWidth = 30;</span>
<span class="fc" id="L66">        this.tankHeight = 16;</span>
<span class="fc" id="L67">        this.turretWidth = 4;</span>
<span class="fc" id="L68">        this.player = player;</span>
<span class="fc" id="L69">        this.angle=0;</span>
<span class="fc" id="L70">        this.speed = 4;</span>
<span class="fc" id="L71">        this.tankCentreX = this.xCoordinate + (this.tankWidth/2);</span>
<span class="fc" id="L72">        this.tankCentreY = this.yCoordinate + (this.tankHeight/2);</span>
<span class="fc" id="L73">    }</span>

    // no Javadoc comments required for setters and getters
    public int getTankWidth() {
<span class="fc" id="L77">        return this.tankWidth;</span>
    }

    public int getTankHeight() {
<span class="fc" id="L81">        return this.tankHeight;</span>
    }

    public int getTurretWidth() {
<span class="nc" id="L85">        return this.turretWidth;</span>
    }

    public void setXCoordinate(float num) {
<span class="fc" id="L89">        this.xCoordinate = num;</span>
<span class="fc" id="L90">    }</span>

    public void setYCoordinate(float num) {
<span class="nc" id="L93">        this.yCoordinate = num;</span>
<span class="nc" id="L94">    }</span>

    public float getXCoordinate() {
<span class="fc" id="L97">        return this.xCoordinate;</span>
    }

    public float getYCoordinate() {
<span class="fc" id="L101">        return this.yCoordinate;</span>
    }

    public void setArrowOn(boolean value) {
<span class="fc" id="L105">        this.arrowOn = value;</span>
<span class="fc" id="L106">    }</span>

    public void setArrowCount(int num) {
<span class="nc" id="L109">        this.arrowCount = num;</span>
<span class="nc" id="L110">    }</span>


    public PShape getTank() {
<span class="nc" id="L114">        return this.tank;</span>
    }

    public void setAngle(float angle) {
<span class="fc" id="L118">        this.angle = angle;</span>
<span class="fc" id="L119">    }</span>

    public float getAngle() {
<span class="fc" id="L122">        return this.angle;</span>
    }

    public Player getPlayer() {
<span class="nc" id="L126">        return this.player;</span>
    }

    public float getTurretXCoordinate() {
<span class="nc" id="L130">        return this.turretXCoordinate;</span>
    }

    public float getTurretYCoordinate() {
<span class="nc" id="L134">        return this.turretYCoordinate;</span>
    }

    public Projectile getProjectile() {
<span class="fc" id="L138">        return this.projectile;</span>
    }

    public void clearProjectile() {
<span class="nc" id="L142">        this.projectile = null;</span>
<span class="nc" id="L143">    }</span>

    public float getTankCentreX() {
<span class="fc" id="L146">        return this.tankCentreX;</span>
    }

    public float getTankCentreY() {
<span class="fc" id="L150">        return this.tankCentreY;</span>
    }

    public void setExplosionOut(boolean value) {
<span class="fc" id="L154">        this.explosionOut = value;</span>
<span class="fc" id="L155">    }</span>

    public boolean getExplosionOut() {
<span class="nc" id="L158">        return this.explosionOut;</span>
    }

    public float getExplosionRadius() {
<span class="fc" id="L162">        return this.explosionRadius;</span>
    }

    /**
     * Increases the y-coordinate when the tank is descending, either on a parachute or without a parachute.
     * 
     * @param increase is the number of pixels we want our y-coordinate to increase by.
     */
    public void increaseYCoordinate(float increase) { // use for descending
<span class="fc bfc" id="L171" title="All 2 branches covered.">        if (this.player.getParachuteOn() == true) {</span>
<span class="fc" id="L172">            this.yCoordinate += increase;</span>
        }
<span class="fc" id="L174">    }</span>
    
    /**
     * Keeps the tank on the terrain.
     */
    public void groundTank() { // handling the logic for where to ground the tanks
<span class="fc" id="L180">        this.movingAverages = this.levelObj.getBackgroundTerrain().getMovingAveragePoints();</span>
<span class="fc" id="L181">        this.yCoordinate = this.movingAverages[(int)this.xCoordinate+(this.tankWidth/2)]-(this.tankHeight);</span>
<span class="fc" id="L182">        this.tankCentreY = this.yCoordinate + (this.tankHeight/2);</span>
<span class="fc" id="L183">    }</span>

    /**
     * Draws the tank. Will draw the shield if it is being hit and has shields left to use.
     */
    public void drawTank() { // draw tank
<span class="fc bfc" id="L189" title="All 2 branches covered.">        if (this.player.getPlayerAlive() == true) {</span>
<span class="fc" id="L190">            app.fill(this.colourScheme[0], this.colourScheme[1], this.colourScheme[2]);</span>
<span class="fc" id="L191">            app.strokeWeight(4);</span>
<span class="fc" id="L192">            app.stroke(0);</span>
<span class="fc" id="L193">            app.rotate(0);</span>
<span class="fc" id="L194">            this.tank = app.createShape(app.RECT, this.xCoordinate, this.yCoordinate, this.tankWidth, this.tankHeight);</span>
<span class="fc" id="L195">            app.shape(this.tank);</span>
<span class="fc" id="L196">            this.player.drawShield();</span>
        }
<span class="fc" id="L198">    }</span>

    /**
     * Draws the turret and handles its rotation when the UP and DOWN keys are pressed.
     */
    public void drawTurret() { // draw turret
<span class="fc bfc" id="L204" title="All 2 branches covered.">        if (this.player.getPlayerAlive() == true) {</span>
<span class="fc" id="L205">            app.fill(0);</span>
<span class="fc" id="L206">            app.stroke(0);</span>
<span class="fc" id="L207">            app.strokeWeight(1);</span>
<span class="fc" id="L208">            app.pushMatrix();</span>
<span class="fc" id="L209">            this.turretXCoordinate = this.xCoordinate+(this.tankWidth/2);</span>
<span class="fc" id="L210">            this.turretYCoordinate = this.yCoordinate;</span>
<span class="fc" id="L211">            app.translate(this.turretXCoordinate, this.turretYCoordinate);</span>
<span class="fc" id="L212">            app.rotate(this.angle);</span>
<span class="fc" id="L213">            app.rectMode(app.CENTER);</span>
<span class="fc" id="L214">            app.rect(0, 0, this.turretWidth, this.tankHeight*2);</span>
<span class="fc" id="L215">            app.popMatrix();</span>
<span class="fc" id="L216">            app.rectMode(app.CORNER);</span>
        }
<span class="fc" id="L218">    }</span>

    /**
     * Draws the arrow indicating the player's turn. Disappears after 2 seconds.
     */
    public void drawArrow() {
<span class="fc bfc" id="L224" title="All 2 branches covered.">        if (this.arrowOn == true) {</span>
<span class="fc" id="L225">            app.fill(0);</span>
<span class="fc" id="L226">            app.stroke(0);</span>
<span class="fc" id="L227">            app.strokeWeight(1);</span>
<span class="fc" id="L228">            app.rectMode(app.CENTER);</span>
<span class="fc" id="L229">            app.rect(this.turretXCoordinate, this.turretYCoordinate-(this.tankHeight*6), this.turretWidth, this.tankHeight*4);</span>
<span class="fc" id="L230">            app.rectMode(app.CORNER);</span>
<span class="fc" id="L231">            app.strokeWeight(this.turretWidth);</span>
<span class="fc" id="L232">            app.line(this.turretXCoordinate-this.tankHeight, this.turretYCoordinate-(this.tankHeight*5), this.turretXCoordinate, this.turretYCoordinate-(this.tankHeight*4));</span>
<span class="fc" id="L233">            app.line(this.turretXCoordinate+this.tankHeight, this.turretYCoordinate-(this.tankHeight*5), this.turretXCoordinate, this.turretYCoordinate-(this.tankHeight*4));</span>
<span class="fc" id="L234">            this.arrowCount += 1;</span>
        }

<span class="fc bfc" id="L237" title="All 2 branches covered.">        if (this.arrowCount == 60) { // remove after two seconds</span>
<span class="fc" id="L238">            this.arrowOn = false;</span>
        }
<span class="fc" id="L240">    }</span>

    /**
     * Rotates the turret left when the UP arrow is pressed. Call in the keyPressed() function of the App class.
     */
    public void rotateTurretLeft() { // up arrow
<span class="pc bpc" id="L246" title="1 of 2 branches missed.">        if (this.angle-(float)0.2&gt;=(float)(-Math.PI/2)) {</span>
<span class="fc" id="L247">            this.angle -= (float)0.2;</span>
        }
<span class="fc" id="L249">    }</span>

    /**
     * Rotates the turret right when the DOWN arrow is pressed. Call in the keyPressed() function of the App class.
     */
    public void rotateTurretRight() { // down arrow
<span class="pc bpc" id="L255" title="1 of 2 branches missed.">        if (this.angle&lt;=(float)Math.PI/2-(float)0.2) {</span>
<span class="fc" id="L256">            this.angle += (float)0.2;</span>
        }
<span class="fc" id="L258">    }</span>

    /**
     * Moves the tank left when the LEFT arrow is pressed by updating the x-coordinate and fuel. Call in the keyPressed() function of the App class.
     */
    public void moveTankLeft() { // left arrow
<span class="fc bfc" id="L264" title="All 4 branches covered.">        if (this.xCoordinate-this.speed &gt;= 0 &amp;&amp; this.player.getFuel()&gt;=this.speed) {</span>
<span class="fc" id="L265">            this.xCoordinate -= this.speed;</span>
<span class="fc" id="L266">            this.tankCentreX = this.xCoordinate + (this.tankWidth/2);</span>

<span class="fc" id="L268">            int currentFuel = this.player.getFuel();</span>
<span class="fc" id="L269">            this.player.setFuel(currentFuel-this.speed);</span>
        }
<span class="fc" id="L271">    }</span>

    /**
     * Moves the tank right when the RIGHT arrow is pressed by updating the x-coordinate and fuel. Call in the keyPressed() function of the App class.
     */
    public void moveTankRight() { // right arrow
<span class="pc bpc" id="L277" title="1 of 4 branches missed.">        if (this.xCoordinate &lt;= 864-30-this.speed &amp;&amp; this.player.getFuel()&gt;=this.speed) {</span>
<span class="fc" id="L278">            this.xCoordinate += this.speed;</span>
<span class="fc" id="L279">            this.tankCentreX = this.xCoordinate + (this.tankWidth/2);</span>

<span class="fc" id="L281">            int currentFuel = this.player.getFuel();</span>
<span class="fc" id="L282">            this.player.setFuel(currentFuel-this.speed);</span>
        }
<span class="fc" id="L284">    }</span>

    /**
     * Creates a new Projectile object each time the spacebar is pressed.
     */
    public void setProjectile() {
<span class="fc" id="L290">        float projectileAngle = 0;</span>
<span class="fc" id="L291">        float projectileXCoordinate = 0;</span>
<span class="fc" id="L292">        float projectileYCoordinate = 0;</span>
<span class="fc" id="L293">        float power = this.player.getPower();</span>
<span class="fc" id="L294">        float diameter = this.turretWidth * 2;</span>

<span class="fc bfc" id="L296" title="All 2 branches covered.">        if (this.angle &lt; 0) {</span>
<span class="fc" id="L297">            projectileAngle = -this.angle - (float)Math.PI/2;</span>
        } else {
<span class="fc" id="L299">            projectileAngle = (float)Math.PI/2 - this.angle;</span>
        }

<span class="fc bfc" id="L302" title="All 2 branches covered.">        if (projectileAngle &lt; 0) {</span>
<span class="fc" id="L303">            projectileXCoordinate = this.turretXCoordinate - (this.tankHeight * (float)Math.cos(Math.abs(projectileAngle)));</span>
<span class="fc bfc" id="L304" title="All 2 branches covered.">        } else if (projectileAngle &gt; 0){</span>
<span class="fc" id="L305">            projectileXCoordinate = this.turretXCoordinate + (this.tankHeight * (float)Math.cos(Math.abs(projectileAngle)));</span>
        } else {
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">            if (this.angle &lt; 0) {</span>
<span class="nc" id="L308">                projectileXCoordinate = this.turretXCoordinate - this.tankHeight;</span>
<span class="pc bpc" id="L309" title="1 of 2 branches missed.">            } else if (this.angle &gt; 0) {</span>
<span class="fc" id="L310">                projectileXCoordinate = this.turretXCoordinate + this.tankHeight;</span>
            }
        }

<span class="fc" id="L314">        projectileYCoordinate = this.turretYCoordinate - (this.tankHeight * (float)Math.sin(Math.abs(projectileAngle)));</span>

<span class="fc" id="L316">        this.projectile = new Projectile(this.app, this, projectileXCoordinate, projectileYCoordinate, projectileAngle, power, diameter, this.colourScheme);</span>
<span class="fc" id="L317">    }</span>

    /**
     * Returns true if another tank is inside the projectile's explosion.
     * 
     * @param tankCentreX is the x-coordinate of another tank's centre.
     * @param tankCentreY is the y-coordinate of another tank's centre.
     * @param explosionCentreX is the x-coordinate of the projectile's explosion centre.
     * @param explosionCentreY is the y-coordinate of the projectile's explosion centre.
     * @return true if another tank is inside the explosion circle, false if otherwise.
     */
    public boolean insideExplosion(float tankCentreX, float tankCentreY, float explosionCentreX, float explosionCentreY) { // check if another tank is inside explosion
<span class="fc bfc" id="L329" title="All 2 branches covered.">        return (((tankCentreX-explosionCentreX)*(tankCentreX-explosionCentreX))+((tankCentreY-explosionCentreY)*(tankCentreY-explosionCentreY)) &lt;= 30 * 30);</span>
    }

    /**
     * Calculates the damange from the explosion. This is proportional to the distance from the explosion.
     * 
     * @param tankCentreX is the x-coordinate of another tank's centre.
     * @param tankCentreY is the y-coordinate of another tank's centre.
     * @param explosionCentreX is the x-coordinate of the projectile's explosion centre.
     * @param explosionCentreY is the y-coordinate of the projectile's explosion centre.
     * @return 30-distance from centre of explosion divided by 30, then multipled by 60; i.e. fraction of damage * 60
     */
    public float damage(float tankCentreX, float tankCentreY, float explosionCentreX, float explosionCentreY) { // calculate damage from explosion proportional to distance from explosion
<span class="fc" id="L342">        return ((30-(float)Math.sqrt(((tankCentreX-explosionCentreX)*(tankCentreX-explosionCentreX)) + ((tankCentreY-explosionCentreY)*(tankCentreY-explosionCentreY))))/30) * 60;</span>
        // 30-distance from centre of explosion divided by 30, then multipled by 60; i.e. fraction of damage * 60
    }

    /**
     * Draws explosion of the tank when it dies.
     * 
     * @return true if executed, false if otherwise.
     */
    public boolean drawExplosion() { // when health is 0
<span class="fc bfc" id="L352" title="All 2 branches covered.">        if (this.explosionOut == true) {</span>
<span class="fc" id="L353">            app.stroke(255, 0, 0);</span>
<span class="fc" id="L354">            app.fill (255, 0, 0);</span>
<span class="fc" id="L355">            app.ellipse(this.tankCentreX, this.tankCentreY, this.explosionRadius*2, this.explosionRadius*2);</span>
<span class="fc" id="L356">            app.stroke(255, 102, 0);</span>
<span class="fc" id="L357">            app.fill(255, 102, 0);</span>
<span class="fc" id="L358">            app.ellipse(this.tankCentreX, this.tankCentreY, this.explosionRadius, this.explosionRadius);</span>
<span class="fc" id="L359">            app.stroke(255, 255, 0);</span>
<span class="fc" id="L360">            app.fill(255, 255, 0);</span>
<span class="fc" id="L361">            app.ellipse(this.tankCentreX, this.tankCentreY, this.explosionRadius*2/5, this.explosionRadius*2/5);</span>
<span class="fc" id="L362">            this.expandExplosion();</span>

<span class="fc" id="L364">            return true;</span>
        }

<span class="fc" id="L367">        return false;</span>
    }

    /**
     * Expands the explosion of the tank as it dies.
     */
    public void expandExplosion() {
<span class="fc" id="L374">        this.explosionRadius += 5; </span>
<span class="fc" id="L375">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>